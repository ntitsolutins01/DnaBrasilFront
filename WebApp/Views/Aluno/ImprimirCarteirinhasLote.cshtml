@model WebApp.Models.AlunoModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Impressão de Carteirinhas em Lote</title>
    <link rel="stylesheet" href="~/assets/styles_Carteirinha/impressao-lote-carteirinha.css" />
    <link rel="stylesheet" href="~/assets/vendor/font-awesome/css/font-awesome.css" />
</head>
<body>
    <div class="print-controls">
        <button class="btn btn-primary" onclick="printFull()">
            <i class="fa fa-print"></i> Imprimir Carteirinha Completa
        </button>
        <button class="btn btn-primary" onclick="printVerso()">
            <i class="fa fa-print"></i> Imprimir Apenas Verso
        </button>
        <button class="btn btn-secondary" onclick="window.close()">
            <i class="fa fa-times"></i> Fechar
        </button>
        <div class="pagination-controls">
            <span id="total-info">Total de carteirinhas: @Model.Alunos.Count()</span>
        </div>
    </div>

    <div class="preview-wrapper">
        @foreach (var aluno in Model.Alunos)
        {
            <div class="preview-container">
                <!-- Frente da carteirinha -->
                <div class="page frente-page">
                    <div class="carteirinha-content">
                        <div class="header">
                            <div class="qr-code">
                                @if (aluno.QrCode != null)
                                {
                                    <div class="qr-image">
                                        @{
                                            var base64QrCode = Convert.ToBase64String(aluno.QrCode);
                                            var imgSrcQrCode = String.Format("data:image/gif;base64,{0}", base64QrCode);
                                        }
                                        <img src="@imgSrcQrCode" style="width:100%;" />
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="main-content">
                            <div class="photo-section">
                                @if (aluno.ByteImage != null && aluno.ByteImage.Length > 0)
                                {
                                    <div class="photo">
                                        @{
                                            var base64 = Convert.ToBase64String(aluno.ByteImage);
                                            var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
                                        }
                                        <img src="@imgSrc" style="width:100%;" />
                                    </div>
                                }
                                else
                                {
                                    <div class="photo" style="background-image: url('@(aluno.Sexo == "Feminino" ? "/assets/images/menina.jpg" : "/assets/images/menino.jpg")');">
                                    </div>
                                }
                            </div>
                            <div class="info-section">
                                <div class="name-role">
                                    <span class="name">@aluno.Nome</span>
                                    <span class="role">Aluno</span>
                                </div>
                                <div class="details">
                                    <div class="detail-row">
                                        <span class="label">CPF:</span>
                                        <span class="value">@aluno.Cpf</span>
                                    </div>
                                    <div class="detail-row modalidade">
                                        <span class="value">@aluno.ModalidadeLinhaAcao</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">Data Nascimento:</span>
                                        <span class="value">@aluno.DtNascimento</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">Telefone:</span>
                                        <span class="value">@aluno.Celular</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="label">Matrícula:</span>
                                        <span class="value">@aluno.Id</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Verso da carteirinha -->
                <div class="page verso-page">
                    <div class="main-content-verso">
                        <div class="info-container">
                            <div class="school-info">
                                <div class="info-group">
                                    <span class="info-label">Município / Estado</span>
                                    <span class="info-value">@aluno.MunicipioEstado</span>
                                </div>
                                <div class="info-group">
                                    <span class="info-label">Unidade Escolar</span>
                                    <span class="info-value">@aluno.NomeLocalidade</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <script>
        function printFull() {
            document.querySelectorAll('.frente-page')
                .forEach(page => page.classList.remove('no-print'));
            document.querySelectorAll('.verso-page')
                .forEach(page => page.classList.remove('no-print'));
            window.print();
        }

        function printVerso() {
            document.querySelectorAll('.frente-page')
                .forEach(page => page.classList.add('no-print'));
            document.querySelectorAll('.verso-page')
                .forEach(page => page.classList.remove('no-print'));
            window.print();
        }
    </script>
</body>
</html>