@using System.Globalization
@model WebApp.Models.AlunoModel
@{
    ViewData["Title"] = "Impressão de Carteirinhas";
    Layout = "";
}

<!DOCTYPE html>
<html>
<head>
    <title>Carteirinha - Aluno @Model.Aluno.Nome</title>
    <link rel="stylesheet" href="~/assets/styles_Carteirinha/impressao-carteirinha.css" />
    <link rel="stylesheet" href="~/assets/vendor/font-awesome/css/font-awesome.css" />
</head>
<body>
    <div class="print-controls">
        <button class="btn btn-primary" onclick="printFull()">
            <i class="fa fa-print"></i> Imprimir Carteirinha Completa
        </button>
        <button class="btn btn-primary" onclick="printVerso()">
            <i class="fa fa-print"></i> Imprimir Apenas Verso
        </button>
        <button class="btn btn-secondary" onclick="window.close()">
            <i class="fa fa-times"></i> Fechar
        </button>
    </div>

    <div class="preview-wrapper">
        <div class="preview-container">
            <!-- Frente da carteirinha -->
            <div class="page frente-page">
                <div class="carteirinha-content">
                    <div class="header">
                        <div class="qr-code">
                            @if (Model.Aluno.QrCode != null)
                            {
                                <div class="qr-image">
                                    @{
                                        var base64QrCode = Convert.ToBase64String(Model.Aluno.QrCode);
                                        var imgSrcQrCode = String.Format("data:image/gif;base64,{0}", base64QrCode);
                                    }
                                    <img src="@imgSrcQrCode" style="width:100%;" />
                                </div>
                            }
                        </div>
                    </div>
                    <div class="main-content">
                        <div class="photo-section">
                            @if (Model.Aluno.ByteImage != null)
                            {
                                <div class="photo">
                                    @{
                                        var base64 = Convert.ToBase64String(Model.Aluno.ByteImage);
                                        var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
                                    }
                                    <img src="@imgSrc" style="width:100%;" />
                                </div>
                            }
                            else if (Model.Aluno.ByteImage == null && Model.Aluno.Sexo == "Feminino")
                            {
                                <div class="photo" style="background-image: url('/assets/images/menina.jpg');">
                                </div>
                            }
                            else if (Model.Aluno.ByteImage == null && Model.Aluno.Sexo == "Masculino")
                            {
                                <div class="photo" style="background-image: url('/assets/images/menino.jpg');">
                                </div>
                            }
                        </div>
                        <div class="info-section">
                            <div class="name-role">
                                <span class="name">@Model.Aluno.Nome</span>
                                <span class="role">Aluno</span>
                            </div>
                            <div class="details">
                                <div class="detail-row">
                                    <span class="label">CPF:</span>
                                    <span class="value">@Model.Aluno.Cpf</span>
                                </div>
                                <div class="detail-row modalidade">
                                    <span class="value">@Model.Aluno.ModalidadeLinhaAcao</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">Data Nascimento:</span>
                                    <span class="value">@Model.Aluno.DtNascimento</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">Telefone:</span>
                                    <span class="value">@Model.Aluno.Celular</span>
                                </div>
                                <div class="detail-row">
                                    <span class="label">Matrícula:</span>
                                    <span class="value">@Model.Aluno.Id</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Verso da carteirinha -->
            <div class="page verso-page">
                <div class="main-content-verso">
                    <div class="info-container">
                        <div class="school-info">
                            <div class="info-group">
                                <span class="info-label">Município / Estado</span>
                                <span class="info-value">@Model.Aluno.MunicipioEstado</span>
                            </div>
                            <div class="info-group">
                                <span class="info-label">Unidade Escolar</span>
                                <span class="info-value">@Model.Aluno.NomeLocalidade</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function printFull() {
            // Remove no-print class
            document
                .querySelectorAll('.frente-page')
                .forEach(function (page) {
                    page.classList.remove('no-print');
                });
            document
                .querySelectorAll('.verso-page')
                .forEach(function (page) {
                    page.classList.remove('no-print');
                });

            // Print
            window.print();
        }

        function printVerso() {
            // Add/remove no-print class
            document
                .querySelectorAll('.frente-page')
                .forEach(function (page) {
                    page.classList.add('no-print');
                });
            document
                .querySelectorAll('.verso-page')
                .forEach(function (page) {
                    page.classList.remove('no-print');
                });

            // Print
            window.print();
        }
    </script>
</body>
</html>